import{d as e,j as a,s as i}from"./index-5OoLnQJN.js";import{r as s}from"./react-vendor-CCsTzcwv.js";import{q as l,h as r,l as n,j as t,r as c,y as d,v as m,p as o,e as g,f as h,u as p,n as j}from"./firebase-vendor-BOy9xtg7.js";const u=()=>{const[u,x]=s.useState([]),[f,y]=s.useState(!0),[v,N]=s.useState(!1),[b,k]=s.useState(!1),[_,w]=s.useState({image_url:"",title:"",description:"",category:"project"});s.useEffect(()=>{C()},[]);const C=async()=>{try{const a=l(r(e,"project_images"),n("created_at","desc")),i=(await t(a)).docs.map(e=>({id:e.id,...e.data()}));x(i)}catch(a){x([])}finally{y(!1)}},z=async a=>{try{const i=a.map(a=>h(r(e,"project_images"),a));await Promise.all(i),C()}catch(i){}},G=async(a,s)=>{if(confirm("Bu görseli silmek istediğinizden emin misiniz?"))try{if(s&&s.includes("firebasestorage"))try{const e=s.split("/"),a=e.slice(e.indexOf("o")+1).join("/"),l=decodeURIComponent(a.split("?")[0]),r=c(i,l);await d(r)}catch(l){}await m(o(e,"project_images",a)),C()}catch(r){alert("Hata: "+r.message)}},S=()=>{w({image_url:"",title:"",description:"",category:"project"})};if(f)return a.jsxs("div",{className:"admin-loading",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("p",{children:"Yükleniyor..."})]});const P=u.filter(e=>"project"===e.category),B=u.filter(e=>"team"===e.category);return a.jsxs("div",{className:"admin-project-images",children:[a.jsxs("div",{className:"admin-page-header",children:[a.jsx("h1",{children:"Proje Görselleri & Bizden Kareler"}),a.jsxs("button",{onClick:()=>{S(),N(!0)},className:"admin-btn-primary",children:[a.jsx("i",{className:"fas fa-plus"})," Yeni Görsel Ekle"]})]}),a.jsxs("div",{className:"admin-image-categories",children:[a.jsxs("div",{className:"admin-image-category",children:[a.jsxs("h2",{children:[a.jsx("i",{className:"fas fa-building"})," Proje Görselleri (",P.length,")"]}),a.jsx("div",{className:"admin-images-grid",children:0===P.length?a.jsx("div",{className:"admin-empty",children:"Henüz proje görseli yok. İlk görseli ekleyin!"}):P.map(e=>a.jsxs("div",{className:"admin-image-card",children:[a.jsxs("div",{className:"admin-image-preview",children:[a.jsx("img",{src:e.image_url,alt:e.title||"Proje görseli"}),a.jsx("div",{className:"admin-image-overlay",children:a.jsx("button",{onClick:()=>G(e.id,e.image_url),className:"admin-btn-delete admin-btn-small",children:a.jsx("i",{className:"fas fa-trash"})})})]}),a.jsxs("div",{className:"admin-image-info",children:[e.title&&a.jsx("h3",{children:e.title}),e.description&&a.jsx("p",{children:e.description})]})]},e.id))})]}),a.jsxs("div",{className:"admin-image-category",children:[a.jsxs("h2",{children:[a.jsx("i",{className:"fas fa-users"})," Bizden Kareler (",B.length,")"]}),a.jsx("div",{className:"admin-images-grid",children:0===B.length?a.jsx("div",{className:"admin-empty",children:"Henüz ekip fotoğrafı yok. İlk fotoğrafı ekleyin!"}):B.map(e=>a.jsxs("div",{className:"admin-image-card",children:[a.jsxs("div",{className:"admin-image-preview",children:[a.jsx("img",{src:e.image_url,alt:e.title||"Ekip fotoğrafı"}),a.jsx("div",{className:"admin-image-overlay",children:a.jsx("button",{onClick:()=>G(e.id,e.image_url),className:"admin-btn-delete admin-btn-small",children:a.jsx("i",{className:"fas fa-trash"})})})]}),a.jsxs("div",{className:"admin-image-info",children:[e.title&&a.jsx("h3",{children:e.title}),e.description&&a.jsx("p",{children:e.description})]})]},e.id))})]})]}),v&&a.jsx("div",{className:"admin-modal-overlay",onClick:()=>N(!1),children:a.jsxs("div",{className:"admin-modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"admin-modal-header",children:[a.jsx("h2",{children:"Yeni Görsel Ekle"}),a.jsx("button",{onClick:()=>N(!1),className:"admin-modal-close",children:a.jsx("i",{className:"fas fa-times"})})]}),a.jsxs("form",{onSubmit:async a=>{if(a.preventDefault(),_.image_url)try{const a={image_url:_.image_url,title:_.title||"",description:_.description||"",category:_.category,created_at:g()};await h(r(e,"project_images"),a),N(!1),S(),C()}catch(i){alert("Hata: "+i.message)}else alert("Lütfen bir resim seçin!")},className:"admin-modal-form",children:[a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Kategori *"}),a.jsxs("select",{value:_.category,onChange:e=>w({..._,category:e.target.value}),required:!0,children:[a.jsx("option",{value:"project",children:"Proje Görseli"}),a.jsx("option",{value:"team",children:"Bizden Kareler"})]})]}),a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Görsel *"}),_.image_url?a.jsxs("div",{className:"admin-image-preview-form",children:[a.jsx("img",{src:_.image_url,alt:"Preview"}),a.jsxs("button",{type:"button",onClick:()=>w({..._,image_url:""}),className:"admin-btn-delete admin-btn-small",children:[a.jsx("i",{className:"fas fa-times"})," Değiştir"]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"admin-upload-area",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{const a=Array.from(e.target.files);if(0!==a.length){k(!0);try{const e=[];for(const s of a){if(!s.type.startsWith("image/")){alert(`${s.name} bir resim dosyası değil!`);continue}const a=s.name.split(".").pop(),l=`${Date.now()}_${Math.random().toString(36).substring(7)}.${a}`,r=c(i,`images/project_images/${l}`);await p(r,s);const n=await j(r);e.push(n)}if(e.length>0&&(w({..._,image_url:e[0]}),e.length>1)){const a=e.slice(1).map(e=>({image_url:e,title:"",description:"",category:_.category,created_at:g()}));await z(a)}}catch(s){alert("Resim yüklenirken hata oluştu: "+s.message)}finally{k(!1)}}},disabled:b,multiple:!0,className:"admin-file-input"}),b&&a.jsxs("div",{className:"admin-upload-status",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Yükleniyor..."]}),a.jsx("p",{className:"admin-upload-hint",children:"Birden fazla görsel seçebilirsiniz. İlk görsel bu formda kullanılacak, diğerleri otomatik kaydedilecek."})]}),a.jsxs("div",{className:"admin-form-group",style:{marginTop:"1rem"},children:[a.jsx("label",{children:"Veya Harici URL Girin"}),a.jsx("input",{type:"text",value:_.image_url,onChange:e=>w({..._,image_url:e.target.value}),placeholder:"https://... veya /images/...",style:{marginTop:"0.5rem"}}),a.jsx("p",{className:"admin-upload-hint",style:{marginTop:"0.5rem"},children:"Firebase Storage yerine harici bir görsel URL'si de kullanabilirsiniz."})]})]})]}),a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Başlık (Opsiyonel)"}),a.jsx("input",{type:"text",value:_.title,onChange:e=>w({..._,title:e.target.value}),placeholder:"Örn: AVM Kurulumu"})]}),a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Açıklama (Opsiyonel)"}),a.jsx("textarea",{value:_.description,onChange:e=>w({..._,description:e.target.value}),placeholder:"Görsel hakkında kısa açıklama...",rows:"3"})]}),a.jsxs("div",{className:"admin-modal-actions",children:[a.jsx("button",{type:"button",onClick:()=>N(!1),className:"admin-btn-secondary",children:"İptal"}),a.jsx("button",{type:"submit",className:"admin-btn-primary",disabled:b||!_.image_url,children:"Kaydet"})]})]})]})})]})};export{u as default};
