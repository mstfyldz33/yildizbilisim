import{u as e,d as a,j as i,s}from"./index-BrpJXW3I.js";import{r as t}from"./react-vendor-CCsTzcwv.js";import{j as n,h as l,x as d,p as r,v as o,e as c,f as m,r as u,y as h,u as x,n as p}from"./firebase-vendor-uW-vpOO9.js";const j=()=>{const{showToast:j}=e(),[y,v]=t.useState([]),[b,g]=t.useState(!0),[f,_]=t.useState(!1),[N,k]=t.useState(null),[C,S]=t.useState({title:"",content:"",icon:"fa-shield-halved",isH1:!1,buttons:[],media_type:"icon",youtube_url:"",video_url:"",video_autoplay:!0,video_muted:!0,video_loop:!0,image_url:""}),[w,H]=t.useState({text:"",href:"",primary:!0}),[z,R]=t.useState(!1);t.useEffect(()=>{Y()},[]);const B=e=>{if(Array.isArray(e))return e;if("string"==typeof e)try{return JSON.parse(e)||[]}catch{return[]}return[]},Y=async()=>{try{const e=(await n(l(a,"hero_slides"))).docs.map(e=>{const a=e.data();return{id:e.id,...a,order_index:a.order_index??999999,buttons:B(a.buttons)}});e.sort((e,a)=>(e.order_index??999999)-(a.order_index??999999)),v(e)}catch(e){v([])}finally{g(!1)}},T=()=>{S({title:"",content:"",icon:"fa-shield-halved",isH1:!1,buttons:[],media_type:"icon",youtube_url:"",video_url:"",video_autoplay:!0,video_muted:!0,video_loop:!0,image_url:""})},q=async(e,i)=>{try{const s=y.findIndex(a=>a.id===e);if(-1===s)return;const t="up"===i?s-1:s+1;if(t<0||t>=y.length)return;const n=y[s],l=y[t];await d(r(a,"hero_slides",n.id),{order_index:l.order_index}),await d(r(a,"hero_slides",l.id),{order_index:n.order_index}),Y()}catch(s){alert("Hata: "+s.message)}};return b?i.jsxs("div",{className:"admin-loading",children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),i.jsx("p",{children:"Yükleniyor..."})]}):i.jsxs("div",{className:"admin-slider",children:[i.jsxs("div",{className:"admin-page-header",children:[i.jsx("h1",{children:"Slider Yönetimi"}),i.jsxs("button",{onClick:()=>{k(null),T(),_(!0)},className:"admin-btn-primary",children:[i.jsx("i",{className:"fas fa-plus"})," Yeni Slide"]})]}),i.jsx("div",{className:"admin-table-container",children:i.jsxs("table",{className:"admin-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Sıra"}),i.jsx("th",{children:"Başlık"}),i.jsx("th",{children:"İkon"}),i.jsx("th",{children:"Buton Sayısı"}),i.jsx("th",{children:"İşlemler"})]})}),i.jsx("tbody",{children:0===y.length?i.jsx("tr",{children:i.jsx("td",{colSpan:"5",className:"admin-empty",children:"Henüz slide yok. İlk slide'ı ekleyin!"})}):y.map((e,s)=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"admin-order-controls",children:[i.jsx("button",{onClick:()=>q(e.id,"up"),disabled:0===s,className:"admin-btn-icon",children:i.jsx("i",{className:"fas fa-chevron-up"})}),i.jsx("span",{children:s+1}),i.jsx("button",{onClick:()=>q(e.id,"down"),disabled:s===y.length-1,className:"admin-btn-icon",children:i.jsx("i",{className:"fas fa-chevron-down"})})]})}),i.jsx("td",{children:e.title}),i.jsx("td",{children:i.jsx("i",{className:`fas ${e.icon}`})}),i.jsx("td",{children:B(e.buttons).length}),i.jsx("td",{children:i.jsxs("div",{className:"admin-actions",children:[i.jsxs("button",{onClick:()=>(e=>{k(e),S({title:e.title||"",content:e.content||"",icon:e.icon||"fa-shield-halved",isH1:e.isH1||!1,buttons:Array.isArray(e.buttons)?e.buttons:[],media_type:e.media_type||"icon",youtube_url:e.youtube_url||"",video_url:e.video_url||"",video_autoplay:void 0===e.video_autoplay||e.video_autoplay,video_muted:void 0===e.video_muted||e.video_muted,video_loop:void 0===e.video_loop||e.video_loop,image_url:e.image_url||""}),_(!0)})(e),className:"admin-btn-edit",children:[i.jsx("i",{className:"fas fa-pen-to-square"})," Düzenle"]}),i.jsxs("button",{onClick:()=>(async e=>{if(confirm("Bu slider öğesini silmek istediğinizden emin misiniz?"))try{await o(r(a,"hero_slides",e)),Y()}catch(i){alert("Hata: "+i.message)}})(e.id),className:"admin-btn-delete",children:[i.jsx("i",{className:"fas fa-trash"})," Sil"]})]})})]},e.id))})]})}),f&&i.jsx("div",{className:"admin-modal-overlay",onClick:()=>_(!1),children:i.jsxs("div",{className:"admin-modal admin-modal-large",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"admin-modal-header",children:[i.jsx("h2",{children:N?"Slide Düzenle":"Yeni Slide"}),i.jsx("button",{onClick:()=>_(!1),className:"admin-modal-close",children:i.jsx("i",{className:"fas fa-times"})})]}),i.jsxs("form",{onSubmit:async e=>{var i;if(e.preventDefault(),"image"!==C.media_type||(null==(i=C.image_url)?void 0:i.trim()))try{const e={...C,buttons:C.buttons,video_autoplay:void 0===C.video_autoplay||C.video_autoplay,video_muted:void 0===C.video_muted||C.video_muted,video_loop:void 0===C.video_loop||C.video_loop,updated_at:c()};if(N)await d(r(a,"hero_slides",N.id),e);else{const i=(await n(l(a,"hero_slides"))).docs.map(e=>e.data().order_index).filter(e=>"number"==typeof e),s=i.length?Math.max(...i,0)+1:0;await m(l(a,"hero_slides"),{...e,created_at:c(),order_index:s})}_(!1),k(null),T(),Y()}catch(s){alert("Hata: "+s.message)}else alert("Resim seçiliyken bir slider resmi yüklemeniz veya URL girmeniz gerekir.")},className:"admin-modal-form",children:[i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Başlık *"}),i.jsx("input",{type:"text",value:C.title,onChange:e=>S({...C,title:e.target.value}),required:!0})]}),i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"İçerik *"}),i.jsx("textarea",{value:C.content,onChange:e=>S({...C,content:e.target.value}),rows:"4",required:!0})]}),i.jsxs("div",{className:"admin-form-row",children:[i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Medya Tipi *"}),i.jsxs("select",{value:C.media_type,onChange:e=>S({...C,media_type:e.target.value}),required:!0,children:[i.jsx("option",{value:"icon",children:"İkon"}),i.jsx("option",{value:"image",children:"Resim"}),i.jsx("option",{value:"youtube",children:"YouTube Video"}),i.jsx("option",{value:"video",children:"Video Dosyası"})]})]}),"icon"===C.media_type&&i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"İkon (Font Awesome class) *"}),i.jsx("input",{type:"text",value:C.icon,onChange:e=>S({...C,icon:e.target.value}),placeholder:"fa-shield-halved",required:!0})]}),"image"===C.media_type&&i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Slider Resmi *"}),C.image_url?i.jsxs("div",{className:"admin-image-preview-form",children:[i.jsx("img",{src:C.image_url,alt:"Slider resmi",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px"}}),i.jsxs("button",{type:"button",onClick:async()=>{if(C.image_url){try{if(C.image_url.includes("firebasestorage")){const e=C.image_url.split("/"),a=e.slice(e.indexOf("o")+1).join("/"),i=decodeURIComponent(a.split("?")[0]),t=u(s,i);await h(t)}}catch(e){}S({...C,image_url:""})}},className:"admin-btn-delete admin-btn-small",children:[i.jsx("i",{className:"fas fa-times"})," Kaldır"]})]}):i.jsxs("div",{className:"admin-upload-area",children:[i.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{const a=e.target.files[0];if(a)if(a.type.startsWith("image/")){R(!0);try{const e=a.name.split(".").pop(),i=`${Date.now()}_${Math.random().toString(36).substring(7)}.${e}`,t=u(s,`images/slider/${i}`);await x(t,a);const n=await p(t);S({...C,image_url:n}),j("Resim yüklendi. Kaydet butonuna basarak slide'ı güncelleyin.","success")}catch(i){j("Resim yüklenemedi: "+(i.message||"Bilinmeyen hata"),"error")}finally{R(!1)}}else alert("Lütfen bir resim dosyası seçin!")},disabled:z,className:"admin-file-input"}),z&&i.jsxs("div",{className:"admin-upload-status",children:[i.jsx("i",{className:"fas fa-spinner fa-spin"})," Yükleniyor..."]}),i.jsx("p",{className:"admin-upload-hint",children:"Slider için resim yükleyebilirsiniz. Önerilen boyut: 1920x1080px"}),i.jsxs("div",{className:"admin-form-group",style:{marginTop:"1rem"},children:[i.jsx("label",{children:"Veya Harici URL Girin"}),i.jsx("input",{type:"text",value:C.image_url,onChange:e=>S({...C,image_url:e.target.value}),placeholder:"https://... veya /images/...",style:{marginTop:"0.5rem"}})]})]})]}),"youtube"===C.media_type&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"YouTube Video URL *"}),i.jsx("input",{type:"text",value:C.youtube_url,onChange:e=>S({...C,youtube_url:e.target.value}),placeholder:"https://www.youtube.com/watch?v=... veya https://youtu.be/...",required:!0}),i.jsx("p",{className:"admin-form-hint",children:"YouTube video linkini yapıştırın. Video otomatik başlayacak, sessiz olacak ve döngüde çalışacak."})]})}),"video"===C.media_type&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Video URL (Firebase Storage veya harici link) *"}),i.jsx("input",{type:"text",value:C.video_url,onChange:e=>S({...C,video_url:e.target.value}),placeholder:"https://... veya /videos/...",required:!0})]}),i.jsxs("div",{className:"admin-form-row",children:[i.jsx("div",{className:"admin-form-group",children:i.jsxs("label",{children:[i.jsx("input",{type:"checkbox",checked:C.video_autoplay,onChange:e=>S({...C,video_autoplay:e.target.checked})}),"Otomatik Başlat"]})}),i.jsx("div",{className:"admin-form-group",children:i.jsxs("label",{children:[i.jsx("input",{type:"checkbox",checked:C.video_muted,onChange:e=>S({...C,video_muted:e.target.checked})}),"Sessiz (Muted)"]})}),i.jsx("div",{className:"admin-form-group",children:i.jsxs("label",{children:[i.jsx("input",{type:"checkbox",checked:C.video_loop,onChange:e=>S({...C,video_loop:e.target.checked})}),"Döngü (Loop)"]})})]}),i.jsx("p",{className:"admin-form-hint",children:"Video dosyaları için MP4 formatı önerilir. Büyük dosyalar için YouTube kullanmanız önerilir."})]}),i.jsx("div",{className:"admin-form-group",children:i.jsxs("label",{children:[i.jsx("input",{type:"checkbox",checked:C.isH1,onChange:e=>S({...C,isH1:e.target.checked})}),"H1 Başlık (SEO için)"]})})]}),i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Butonlar"}),i.jsxs("div",{className:"admin-buttons-list",children:[C.buttons.map((e,a)=>i.jsxs("div",{className:"admin-button-item",children:[i.jsx("span",{children:e.text}),i.jsx("span",{className:"admin-button-href",children:e.href}),i.jsx("span",{className:"admin-button-type",children:e.primary?"Primary":"Secondary"}),i.jsx("button",{type:"button",onClick:()=>(e=>{S({...C,buttons:C.buttons.filter((a,i)=>i!==e)})})(a),className:"admin-feature-remove",children:i.jsx("i",{className:"fas fa-times"})})]},a)),i.jsxs("div",{className:"admin-button-add",children:[i.jsx("input",{type:"text",placeholder:"Buton Metni",value:w.text,onChange:e=>H({...w,text:e.target.value}),style:{flex:1}}),i.jsx("input",{type:"text",placeholder:"Link (#services)",value:w.href,onChange:e=>H({...w,href:e.target.value}),style:{flex:1}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[i.jsx("input",{type:"checkbox",checked:w.primary,onChange:e=>H({...w,primary:e.target.checked})}),"Primary"]}),i.jsx("button",{type:"button",onClick:()=>{w.text.trim()&&w.href.trim()&&(S({...C,buttons:[...C.buttons,{...w}]}),H({text:"",href:"",primary:!0}))},className:"admin-btn-small",children:i.jsx("i",{className:"fas fa-plus"})})]})]})]}),i.jsxs("div",{className:"admin-modal-actions",children:[i.jsx("button",{type:"button",onClick:()=>_(!1),className:"admin-btn-secondary",children:"İptal"}),i.jsx("button",{type:"submit",className:"admin-btn-primary",children:N?"Güncelle":"Kaydet"})]})]})]})})]})};export{j as default};
