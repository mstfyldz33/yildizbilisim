import{u as e,d as i,j as a,s}from"./index-5OoLnQJN.js";import{r as t}from"./react-vendor-CCsTzcwv.js";import{j as l,h as n,x as r,p as d,v as o,e as c,f as m,r as u,y as h,u as p,n as x,z as y}from"./firebase-vendor-BOy9xtg7.js";const v=()=>{const{showToast:v}=e(),[b,j]=t.useState([]),[g,f]=t.useState(!0),[_,k]=t.useState(!1),[N,w]=t.useState(null),[C,S]=t.useState({title:"",content:"",icon:"fa-shield-halved",isH1:!1,buttons:[],media_type:"icon",youtube_url:"",video_url:"",video_autoplay:!0,video_muted:!0,video_loop:!0,image_url:""}),[R,z]=t.useState({text:"",href:"",primary:!0}),[B,H]=t.useState(!1);t.useEffect(()=>{V()},[]);const P=e=>{if(Array.isArray(e))return e;if("string"==typeof e)try{return JSON.parse(e)||[]}catch{return[]}return[]},V=async()=>{try{const e=(await l(n(i,"hero_slides"))).docs.map(e=>{const i=e.data();return{id:e.id,...i,order_index:i.order_index??999999,buttons:P(i.buttons)}});e.sort((e,i)=>(e.order_index??999999)-(i.order_index??999999)),j(e)}catch(e){j([])}finally{f(!1)}},L=500,M=()=>{S({title:"",content:"",icon:"fa-shield-halved",isH1:!1,buttons:[],media_type:"icon",youtube_url:"",video_url:"",video_autoplay:!0,video_muted:!0,video_loop:!0,image_url:""})},T=1920,U=1080,$=e=>new Promise((i,a)=>{const s=new Image,t=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(t);const e=document.createElement("canvas");e.width=T,e.height=U;const l=e.getContext("2d");if(!l)return void a(new Error("Canvas desteklenmiyor"));const n=Math.max(T/s.width,U/s.height),r=s.width*n,d=s.height*n,o=(T-r)/2,c=(U-d)/2;l.drawImage(s,o,c,r,d,0,0,T,U);var m;m=(s,t)=>{var l;s?(l=(e,s)=>{e?a(e):i(s)},e.toBlob(e=>{e?l(null,{blob:e,mimeType:"image/jpeg",ext:"jpg"}):l(new Error("JPEG dönüştürülemedi"))},"image/jpeg",.88)):i(t)},e.toBlob(e=>{e?m(null,{blob:e,mimeType:"image/webp",ext:"webp"}):m(new Error("WebP desteklenmiyor"))},"image/webp",.88)},s.onerror=()=>{URL.revokeObjectURL(t),a(new Error("Resim açılamadı. Dosya bozuk veya format desteklenmiyor olabilir."))},s.src=t}),G=async(e,a)=>{try{const s=b.findIndex(i=>i.id===e);if(-1===s)return;const t="up"===a?s-1:s+1;if(t<0||t>=b.length)return;const l=b[s],n=b[t];await r(d(i,"hero_slides",l.id),{order_index:n.order_index}),await r(d(i,"hero_slides",n.id),{order_index:l.order_index}),V()}catch(s){alert("Hata: "+s.message)}};return g?a.jsxs("div",{className:"admin-loading",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("p",{children:"Yükleniyor..."})]}):a.jsxs("div",{className:"admin-slider",children:[a.jsxs("div",{className:"admin-page-header",children:[a.jsx("h1",{children:"Slider Yönetimi"}),a.jsxs("button",{onClick:()=>{w(null),M(),k(!0)},className:"admin-btn-primary",children:[a.jsx("i",{className:"fas fa-plus"})," Yeni Slide"]})]}),a.jsx("div",{className:"admin-table-container",children:a.jsxs("table",{className:"admin-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Sıra"}),a.jsx("th",{children:"Başlık"}),a.jsx("th",{children:"İkon"}),a.jsx("th",{children:"Buton Sayısı"}),a.jsx("th",{children:"İşlemler"})]})}),a.jsx("tbody",{children:0===b.length?a.jsx("tr",{children:a.jsx("td",{colSpan:"5",className:"admin-empty",children:"Henüz slide yok. İlk slide'ı ekleyin!"})}):b.map((e,s)=>a.jsxs("tr",{children:[a.jsx("td",{children:a.jsxs("div",{className:"admin-order-controls",children:[a.jsx("button",{onClick:()=>G(e.id,"up"),disabled:0===s,className:"admin-btn-icon",children:a.jsx("i",{className:"fas fa-chevron-up"})}),a.jsx("span",{children:s+1}),a.jsx("button",{onClick:()=>G(e.id,"down"),disabled:s===b.length-1,className:"admin-btn-icon",children:a.jsx("i",{className:"fas fa-chevron-down"})})]})}),a.jsx("td",{children:e.title}),a.jsx("td",{children:a.jsx("i",{className:`fas ${e.icon}`})}),a.jsx("td",{children:P(e.buttons).length}),a.jsx("td",{children:a.jsxs("div",{className:"admin-actions",children:[a.jsxs("button",{onClick:()=>(e=>{w(e),S({title:e.title||"",content:e.content||"",icon:e.icon||"fa-shield-halved",isH1:e.isH1||!1,buttons:Array.isArray(e.buttons)?e.buttons:[],media_type:e.media_type||"icon",youtube_url:e.youtube_url||"",video_url:e.video_url||"",video_autoplay:void 0===e.video_autoplay||e.video_autoplay,video_muted:void 0===e.video_muted||e.video_muted,video_loop:void 0===e.video_loop||e.video_loop,image_url:e.image_url||""}),k(!0)})(e),className:"admin-btn-edit",children:[a.jsx("i",{className:"fas fa-pen-to-square"})," Düzenle"]}),a.jsxs("button",{onClick:()=>(async e=>{if(confirm("Bu slider öğesini silmek istediğinizden emin misiniz?"))try{await o(d(i,"hero_slides",e)),V()}catch(a){alert("Hata: "+a.message)}})(e.id),className:"admin-btn-delete",children:[a.jsx("i",{className:"fas fa-trash"})," Sil"]})]})})]},e.id))})]})}),_&&a.jsx("div",{className:"admin-modal-overlay",onClick:()=>k(!1),children:a.jsxs("div",{className:"admin-modal admin-modal-large",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"admin-modal-header",children:[a.jsx("h2",{children:N?"Slide Düzenle":"Yeni Slide"}),a.jsx("button",{onClick:()=>k(!1),className:"admin-modal-close",children:a.jsx("i",{className:"fas fa-times"})})]}),a.jsxs("form",{onSubmit:async e=>{var a,s;if(e.preventDefault(),"image"!==C.media_type||(null==(a=C.image_url)?void 0:a.trim()))if("video"!==C.media_type||(null==(s=C.video_url)?void 0:s.trim()))try{const e={title:C.title||"",content:C.content||"",icon:C.icon||"fa-shield-halved",isH1:!!C.isH1,buttons:Array.isArray(C.buttons)?C.buttons:[],media_type:C.media_type||"icon",image_url:C.image_url&&String(C.image_url).trim()||"",youtube_url:C.youtube_url&&String(C.youtube_url).trim()||"",video_url:C.video_url&&String(C.video_url).trim()||"",video_autoplay:void 0===C.video_autoplay||C.video_autoplay,video_muted:void 0===C.video_muted||C.video_muted,video_loop:void 0===C.video_loop||C.video_loop,updated_at:c()};if(N)await r(d(i,"hero_slides",N.id),e);else{const a=(await l(n(i,"hero_slides"))).docs.map(e=>e.data().order_index).filter(e=>"number"==typeof e),s=a.length?Math.max(...a,0)+1:0;await m(n(i,"hero_slides"),{...e,created_at:c(),order_index:s})}k(!1),w(null),M(),V()}catch(t){alert("Hata: "+t.message)}else alert("Video seçiliyken bir video yüklemeniz veya URL girmeniz gerekir.");else alert("Resim seçiliyken bir slider resmi yüklemeniz veya URL girmeniz gerekir.")},className:"admin-modal-form",children:[a.jsxs("div",{className:"admin-form-group",children:[a.jsxs("label",{children:["Başlık ",["icon"].includes(C.media_type)?"*":"(Görsel/Video slaytlarda boş bırakılabilir)"]}),a.jsx("input",{type:"text",value:C.title,onChange:e=>S({...C,title:e.target.value}),required:"icon"===C.media_type,placeholder:"icon"!==C.media_type?"Boş bırakırsanız sadece görsel/video gösterilir":""})]}),a.jsxs("div",{className:"admin-form-group",children:[a.jsxs("label",{children:["İçerik ",["icon"].includes(C.media_type)?"*":"(Görsel/Video slaytlarda boş bırakılabilir)"]}),a.jsx("textarea",{value:C.content,onChange:e=>S({...C,content:e.target.value}),rows:"4",required:"icon"===C.media_type,placeholder:"icon"!==C.media_type?"Boş bırakırsanız sadece görsel/video gösterilir":""})]}),a.jsxs("div",{className:"admin-form-row",children:[a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Medya Tipi *"}),a.jsxs("select",{value:C.media_type,onChange:e=>S({...C,media_type:e.target.value}),required:!0,children:[a.jsx("option",{value:"icon",children:"İkon"}),a.jsx("option",{value:"image",children:"Resim"}),a.jsx("option",{value:"youtube",children:"YouTube Video"}),a.jsx("option",{value:"video",children:"Video Dosyası"})]})]}),"icon"===C.media_type&&a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"İkon (Font Awesome class) *"}),a.jsx("input",{type:"text",value:C.icon,onChange:e=>S({...C,icon:e.target.value}),placeholder:"fa-shield-halved",required:!0})]}),"image"===C.media_type&&a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Slider Resmi *"}),C.image_url?a.jsxs("div",{className:"admin-image-preview-form",children:[a.jsx("img",{src:C.image_url,alt:"Slider resmi",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px"}}),a.jsxs("button",{type:"button",onClick:async()=>{if(C.image_url){try{if(C.image_url.includes("firebasestorage")){const e=C.image_url.split("/"),i=e.slice(e.indexOf("o")+1).join("/"),a=decodeURIComponent(i.split("?")[0]),t=u(s,a);await h(t)}}catch(e){}S({...C,image_url:""})}},className:"admin-btn-delete admin-btn-small",children:[a.jsx("i",{className:"fas fa-times"})," Kaldır"]})]}):a.jsxs("div",{className:"admin-upload-area",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{const i=e.target.files[0];if(i)if(i.type.startsWith("image/")){H(!0);try{const{blob:e,mimeType:a,ext:t}=await $(i),l=`${Date.now()}_${Math.random().toString(36).substring(7)}.${t}`,n=u(s,`images/slider/${l}`);await p(n,e,{contentType:a});const r=await x(n);S(e=>({...e,image_url:r})),v("Resim 1920×1080 yüklendi. Kaydet butonuna basın.","success")}catch(a){v("Resim yüklenemedi: "+(a.message||"Bilinmeyen hata"),"error")}finally{H(!1),e.target.value=""}}else v("Lütfen bir resim dosyası seçin (JPG, PNG, WebP).","error")},disabled:B,className:"admin-file-input"}),B&&a.jsxs("div",{className:"admin-upload-status",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Yükleniyor..."]}),a.jsx("p",{className:"admin-upload-hint",children:"Resim yükleyin (JPG, PNG, WebP); otomatik 1920×1080 WebP'ye çevrilir."}),a.jsxs("div",{className:"admin-form-group",style:{marginTop:"1rem"},children:[a.jsx("label",{children:"Veya Harici URL Girin"}),a.jsx("input",{type:"text",value:C.image_url,onChange:e=>S({...C,image_url:e.target.value}),placeholder:"https://... veya /images/...",style:{marginTop:"0.5rem"}})]})]})]}),"youtube"===C.media_type&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"YouTube Video URL *"}),a.jsx("input",{type:"text",value:C.youtube_url,onChange:e=>S({...C,youtube_url:e.target.value}),placeholder:"https://www.youtube.com/watch?v=... veya https://youtu.be/...",required:!0}),a.jsx("p",{className:"admin-form-hint",children:"YouTube video linkini yapıştırın. Video otomatik başlayacak, sessiz olacak ve döngüde çalışacak."})]})}),"video"===C.media_type&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"admin-form-group",children:[a.jsxs("label",{children:["Video (maks. ",L,"MB) *"]}),C.video_url?a.jsxs("div",{className:"admin-image-preview-form",children:[a.jsx("video",{src:C.video_url,controls:!0,style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"8px"}}),a.jsxs("button",{type:"button",onClick:()=>{S({...C,video_url:""})},className:"admin-btn-delete admin-btn-small",children:[a.jsx("i",{className:"fas fa-times"})," Kaldır"]})]}):a.jsxs("div",{className:"admin-upload-area",children:[a.jsx("input",{type:"file",accept:"video/*",onChange:async e=>{const i=e.target.files[0];if(i)if(i.type.startsWith("video/"))if(i.size>524288e3)v(`Video en fazla 500MB olabilir. Seçilen: ${(i.size/1048576).toFixed(1)}MB`,"error");else{H(!0);try{const e=i.name.split(".").pop(),a=`${Date.now()}_${Math.random().toString(36).substring(7)}.${e}`,t=u(s,`videos/slider/${a}`);if(i.size>52428800){const e=y(t,i);await new Promise((i,a)=>{e.on("state_changed",e=>{},a,()=>x(e.snapshot.ref).then(i))}).then(e=>{S({...C,video_url:e})})}else{await p(t,i);const e=await x(t);S({...C,video_url:e})}v("Video yüklendi. Kaydet butonuna basarak slide'ı güncelleyin.","success")}catch(a){v("Video yüklenemedi: "+(a.message||"Bilinmeyen hata"),"error")}finally{H(!1),e.target.value=""}}else v("Lütfen bir video dosyası seçin (MP4, WebM vb.)","error")},disabled:B,className:"admin-file-input"}),B&&a.jsxs("div",{className:"admin-upload-status",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Video yükleniyor..."]}),a.jsxs("p",{className:"admin-upload-hint",children:["Video yükleyin (maks. ",L,"MB). MP4 önerilir. Mobilde de senkron çalışır."]})]}),a.jsxs("div",{className:"admin-form-group",style:{marginTop:"1rem"},children:[a.jsx("label",{children:"Veya Video URL girin"}),a.jsx("input",{type:"text",value:C.video_url,onChange:e=>S({...C,video_url:e.target.value}),placeholder:"https://..."})]})]}),a.jsxs("div",{className:"admin-form-row",children:[a.jsx("div",{className:"admin-form-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:C.video_autoplay,onChange:e=>S({...C,video_autoplay:e.target.checked})}),"Otomatik Başlat"]})}),a.jsx("div",{className:"admin-form-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:C.video_muted,onChange:e=>S({...C,video_muted:e.target.checked})}),"Sessiz (Muted)"]})}),a.jsx("div",{className:"admin-form-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:C.video_loop,onChange:e=>S({...C,video_loop:e.target.checked})}),"Döngü (Loop)"]})})]})]}),a.jsx("div",{className:"admin-form-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:C.isH1,onChange:e=>S({...C,isH1:e.target.checked})}),"H1 Başlık (SEO için)"]})})]}),a.jsxs("div",{className:"admin-form-group",children:[a.jsx("label",{children:"Butonlar"}),a.jsxs("div",{className:"admin-buttons-list",children:[C.buttons.map((e,i)=>a.jsxs("div",{className:"admin-button-item",children:[a.jsx("span",{children:e.text}),a.jsx("span",{className:"admin-button-href",children:e.href}),a.jsx("span",{className:"admin-button-type",children:e.primary?"Primary":"Secondary"}),a.jsx("button",{type:"button",onClick:()=>(e=>{S({...C,buttons:C.buttons.filter((i,a)=>a!==e)})})(i),className:"admin-feature-remove",children:a.jsx("i",{className:"fas fa-times"})})]},i)),a.jsxs("div",{className:"admin-button-add",children:[a.jsx("input",{type:"text",placeholder:"Buton Metni",value:R.text,onChange:e=>z({...R,text:e.target.value}),style:{flex:1}}),a.jsx("input",{type:"text",placeholder:"Link (#services)",value:R.href,onChange:e=>z({...R,href:e.target.value}),style:{flex:1}}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("input",{type:"checkbox",checked:R.primary,onChange:e=>z({...R,primary:e.target.checked})}),"Primary"]}),a.jsx("button",{type:"button",onClick:()=>{R.text.trim()&&R.href.trim()&&(S({...C,buttons:[...C.buttons,{...R}]}),z({text:"",href:"",primary:!0}))},className:"admin-btn-small",children:a.jsx("i",{className:"fas fa-plus"})})]})]})]}),a.jsxs("div",{className:"admin-modal-actions",children:[a.jsx("button",{type:"button",onClick:()=>k(!1),className:"admin-btn-secondary",children:"İptal"}),a.jsx("button",{type:"submit",className:"admin-btn-primary",children:N?"Güncelle":"Kaydet"})]})]})]})})]})};export{v as default};
