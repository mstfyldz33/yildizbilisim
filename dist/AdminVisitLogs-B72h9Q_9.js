import{d as e,j as a}from"./index-5OoLnQJN.js";import{r as s}from"./react-vendor-CCsTzcwv.js";import{q as i,h as t,l as n,m as l,T as d,w as r,j as c,k as o,v as m,p as h}from"./firebase-vendor-BOy9xtg7.js";const j=()=>{const[j,x]=s.useState([]),[p,v]=s.useState(!0),[f,u]=s.useState({startDate:"",endDate:"",page:"",ip:"",eventType:""}),[g,y]=s.useState({totalVisits:0,uniqueIPs:0,todayVisits:0});s.useEffect(()=>{N(),D()},[f]);const N=async()=>{try{let a=i(t(e,"visit_logs"),n("created_at","desc"),l(500));if(f.startDate){const e=d.fromDate(new Date(f.startDate));a=i(a,r("created_at",">=",e))}if(f.endDate){const e=d.fromDate(new Date(f.endDate+"T23:59:59"));a=i(a,r("created_at","<=",e))}f.eventType&&(a=i(a,r("event_type","==",f.eventType)));let s=(await c(a)).docs.map(e=>({id:e.id,...e.data()}));f.page&&(s=s.filter(e=>{var a;return null==(a=e.page)?void 0:a.toLowerCase().includes(f.page.toLowerCase())})),f.ip&&(s=s.filter(e=>{var a;return null==(a=e.ip_address)?void 0:a.toLowerCase().includes(f.ip.toLowerCase())})),x(s)}catch(a){}finally{v(!1)}},D=async()=>{try{const a=(await o(t(e,"visit_logs"))).data().count||0,s=await c(t(e,"visit_logs")),n=new Set;s.docs.forEach(e=>{const a=e.data();a.ip_address&&n.add(a.ip_address)});const l=new Date;l.setHours(0,0,0,0);const m=d.fromDate(l),h=i(t(e,"visit_logs"),r("created_at",">=",m)),j=(await o(h)).data().count||0;y({totalVisits:a,uniqueIPs:n.size,todayVisits:j})}catch(a){}},w=e=>{let a;return a=(null==e?void 0:e.toDate)?e.toDate():(null==e?void 0:e.seconds)?new Date(1e3*e.seconds):new Date(e),a.toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return p?a.jsxs("div",{className:"admin-loading",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("p",{children:"Yükleniyor..."})]}):a.jsxs("div",{className:"admin-visit-logs",children:[a.jsxs("div",{className:"admin-page-header",children:[a.jsx("h1",{children:"Ziyaret Logları & IP Takibi"}),a.jsxs("button",{onClick:async()=>{if(confirm("30 günden eski tüm log kayıtlarını silmek istediğinizden emin misiniz?"))try{const a=new Date;a.setDate(a.getDate()-30);const s=d.fromDate(a),n=i(t(e,"visit_logs"),r("created_at","<",s)),l=(await c(n)).docs.map(e=>m(e.ref));await Promise.all(l),N(),D(),alert("Eski loglar silindi!")}catch(a){alert("Hata: "+a.message)}},className:"admin-btn-secondary",children:[a.jsx("i",{className:"fas fa-trash"})," 30+ Günlük Eski Logları Temizle"]})]}),a.jsxs("div",{className:"admin-stats-grid",children:[a.jsxs("div",{className:"admin-stat-card",children:[a.jsx("div",{className:"admin-stat-icon visit",children:a.jsx("i",{className:"fas fa-chart-line"})}),a.jsxs("div",{className:"admin-stat-content",children:[a.jsx("h3",{children:g.totalVisits}),a.jsx("p",{children:"Toplam Ziyaret"})]})]}),a.jsxs("div",{className:"admin-stat-card",children:[a.jsx("div",{className:"admin-stat-icon ip",children:a.jsx("i",{className:"fas fa-network-wired"})}),a.jsxs("div",{className:"admin-stat-content",children:[a.jsx("h3",{children:g.uniqueIPs}),a.jsx("p",{children:"Benzersiz IP"})]})]}),a.jsxs("div",{className:"admin-stat-card",children:[a.jsx("div",{className:"admin-stat-icon today",children:a.jsx("i",{className:"fas fa-calendar-day"})}),a.jsxs("div",{className:"admin-stat-content",children:[a.jsx("h3",{children:g.todayVisits}),a.jsx("p",{children:"Bugünkü Ziyaret"})]})]})]}),a.jsxs("div",{className:"admin-filters",children:[a.jsx("h3",{children:"Filtreler"}),a.jsxs("div",{className:"admin-filter-grid",children:[a.jsxs("div",{className:"admin-filter-item",children:[a.jsx("label",{children:"Başlangıç Tarihi"}),a.jsx("input",{type:"date",value:f.startDate,onChange:e=>u({...f,startDate:e.target.value})})]}),a.jsxs("div",{className:"admin-filter-item",children:[a.jsx("label",{children:"Bitiş Tarihi"}),a.jsx("input",{type:"date",value:f.endDate,onChange:e=>u({...f,endDate:e.target.value})})]}),a.jsxs("div",{className:"admin-filter-item",children:[a.jsx("label",{children:"Sayfa"}),a.jsx("input",{type:"text",placeholder:"Sayfa URL'i",value:f.page,onChange:e=>u({...f,page:e.target.value})})]}),a.jsxs("div",{className:"admin-filter-item",children:[a.jsx("label",{children:"IP Adresi"}),a.jsx("input",{type:"text",placeholder:"IP adresi",value:f.ip,onChange:e=>u({...f,ip:e.target.value})})]}),a.jsxs("div",{className:"admin-filter-item",children:[a.jsx("label",{children:"Olay Tipi"}),a.jsxs("select",{value:f.eventType,onChange:e=>u({...f,eventType:e.target.value}),children:[a.jsx("option",{value:"",children:"Tümü"}),a.jsx("option",{value:"page_view",children:"Sayfa Görüntüleme"}),a.jsx("option",{value:"click",children:"Tıklama"}),a.jsx("option",{value:"download",children:"İndirme"})]})]}),a.jsx("div",{className:"admin-filter-item",children:a.jsxs("button",{onClick:()=>u({startDate:"",endDate:"",page:"",ip:"",eventType:""}),className:"admin-btn-secondary",children:[a.jsx("i",{className:"fas fa-times"})," Filtreleri Temizle"]})})]})]}),a.jsx("div",{className:"admin-table-container",children:a.jsxs("table",{className:"admin-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Tarih/Saat"}),a.jsx("th",{children:"IP Adresi"}),a.jsx("th",{children:"Sayfa"}),a.jsx("th",{children:"Platform"}),a.jsx("th",{children:"Olay Tipi"}),a.jsx("th",{children:"Referrer"}),a.jsx("th",{children:"İşlemler"})]})}),a.jsx("tbody",{children:0===j.length?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"admin-empty",children:"Henüz log kaydı yok."})}):j.map(s=>a.jsxs("tr",{children:[a.jsx("td",{children:w(s.created_at)}),a.jsx("td",{children:a.jsx("code",{children:s.ip_address})}),a.jsx("td",{children:s.page}),a.jsx("td",{children:s.platform||"-"}),a.jsx("td",{children:a.jsx("span",{className:"admin-event-badge",children:s.event_type||"page_view"})}),a.jsx("td",{className:"admin-referrer",children:s.referrer||"-"}),a.jsx("td",{children:a.jsx("button",{onClick:()=>(async a=>{if(confirm("Bu log kaydını silmek istediğinizden emin misiniz?"))try{await m(h(e,"visit_logs",a)),N(),D()}catch(s){alert("Hata: "+s.message)}})(s.id),className:"admin-btn-delete",title:"Sil",children:a.jsx("i",{className:"fas fa-trash"})})})]},s.id))})]})})]})};export{j as default};
