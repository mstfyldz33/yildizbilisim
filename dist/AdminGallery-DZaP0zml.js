const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["heic2any-DRSXiZIm.js","react-vendor-CCsTzcwv.js"])))=>i.map(i=>d[i]);
import{u as e,d as a,j as i,s,_ as l}from"./index-DuKwbuAV.js";import{r as n}from"./react-vendor-CCsTzcwv.js";import{j as t,h as r,r as d,y as c,v as m,p as o,e as u,x as h,f as g,u as p,n as y}from"./firebase-vendor-BOy9xtg7.js";const f=()=>{const{showToast:f}=e(),[j,x]=n.useState([]),[v,N]=n.useState(!0),[b,_]=n.useState(!1),[k,C]=n.useState(null),[w,G]=n.useState({title:"",count:"",icon:"fa-building",image_url:""}),[P,E]=n.useState(!1);n.useEffect(()=>{S()},[]);const S=async()=>{try{const e=(await t(r(a,"gallery"))).docs.map(e=>{var a,i;return{id:e.id,...e.data(),_sort:(null==(i=null==(a=e.data().created_at)?void 0:a.toMillis)?void 0:i.call(a))??e.data().created_at??0}});e.sort((e,a)=>(a._sort||0)-(e._sort||0)),x(e.map(({_sort:e,...a})=>a))}catch(e){}finally{N(!1)}},I=e=>{const a=(e.name||"").toLowerCase(),i=(e.type||"").toLowerCase();return a.endsWith(".heic")||a.endsWith(".heif")||"image/heic"===i||"image/heif"===i},H=(e,a,i)=>Promise.race([e,new Promise((e,s)=>setTimeout(()=>s(new Error(`${i} çok uzun sürdü (${a/1e3}s). Tekrar deneyin veya JPG kullanın.`)),a))]),R=()=>{G({title:"",count:"",icon:"fa-building",image_url:""})};return v?i.jsxs("div",{className:"admin-loading",children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),i.jsx("p",{children:"Yükleniyor..."})]}):i.jsxs("div",{className:"admin-gallery",children:[i.jsxs("div",{className:"admin-page-header",children:[i.jsx("h1",{children:"Galeri Yönetimi"}),i.jsxs("button",{onClick:()=>{C(null),R(),_(!0)},className:"admin-btn-primary",children:[i.jsx("i",{className:"fas fa-plus"})," Yeni Galeri Öğesi"]})]}),i.jsx("div",{className:"admin-gallery-grid",children:0===j.length?i.jsx("div",{className:"admin-empty",children:"Henüz galeri öğesi yok. İlk öğeyi ekleyin!"}):j.map(e=>i.jsxs("div",{className:"admin-gallery-card",children:[i.jsx("div",{className:"admin-gallery-image",children:e.image_url?i.jsx("img",{src:e.image_url,alt:e.title}):i.jsx("i",{className:`fas ${e.icon}`})}),i.jsxs("div",{className:"admin-gallery-info",children:[i.jsx("h3",{children:e.title}),i.jsx("p",{children:e.count})]}),i.jsxs("div",{className:"admin-gallery-actions",children:[i.jsxs("button",{onClick:()=>(e=>{C(e),G({title:e.title||"",count:e.count||"",icon:e.icon||"fa-building",image_url:e.image_url||""}),_(!0)})(e),className:"admin-btn-edit",children:[i.jsx("i",{className:"fas fa-pen-to-square"})," Düzenle"]}),i.jsxs("button",{onClick:()=>(async(e,i)=>{if(confirm("Bu galeri öğesini silmek istediğinizden emin misiniz?"))try{if(i&&i.includes("firebasestorage"))try{const e=i.split("/"),a=e.slice(e.indexOf("o")+1).join("/"),l=decodeURIComponent(a.split("?")[0]),n=d(s,l);await c(n)}catch(l){}await m(o(a,"gallery",e)),S(),f("Galeri öğesi silindi!","success")}catch(n){f("Hata: "+n.message,"error")}})(e.id,e.image_url),className:"admin-btn-delete",children:[i.jsx("i",{className:"fas fa-trash"})," Sil"]})]})]},e.id))}),b&&i.jsx("div",{className:"admin-modal-overlay",onClick:()=>_(!1),children:i.jsxs("div",{className:"admin-modal",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"admin-modal-header",children:[i.jsx("h2",{children:k?"Galeri Öğesi Düzenle":"Yeni Galeri Öğesi"}),i.jsx("button",{onClick:()=>_(!1),className:"admin-modal-close",children:i.jsx("i",{className:"fas fa-times"})})]}),i.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e={...w,updated_at:u()};k?await h(o(a,"gallery",k.id),e):await g(r(a,"gallery"),{...e,created_at:u()}),_(!1),C(null),R(),S(),f(k?"Galeri öğesi güncellendi!":"Galeri öğesi eklendi!","success")}catch(i){f("Hata: "+i.message,"error")}},className:"admin-modal-form",children:[i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Başlık *"}),i.jsx("input",{type:"text",value:w.title,onChange:e=>G({...w,title:e.target.value}),placeholder:"Örn: AVM Kurulumu",required:!0})]}),i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Sayı/Bilgi *"}),i.jsx("input",{type:"text",value:w.count,onChange:e=>G({...w,count:e.target.value}),placeholder:"Örn: 64 IP Kamera",required:!0})]}),i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"İkon (Font Awesome class)"}),i.jsx("input",{type:"text",value:w.icon,onChange:e=>G({...w,icon:e.target.value}),placeholder:"fa-building"})]}),i.jsxs("div",{className:"admin-form-group",children:[i.jsx("label",{children:"Resim"}),w.image_url?i.jsxs("div",{className:"admin-image-preview",children:[i.jsx("img",{src:w.image_url,alt:"Preview"}),i.jsxs("button",{type:"button",onClick:async()=>{if(w.image_url)try{if(w.image_url.includes("firebasestorage")){const e=w.image_url.split("/"),a=e.slice(e.indexOf("o")+1).join("/"),i=decodeURIComponent(a.split("?")[0]),l=d(s,i);await c(l)}G({...w,image_url:""})}catch(e){}},className:"admin-btn-delete admin-btn-small",children:[i.jsx("i",{className:"fas fa-trash"})," Resmi Kaldır"]})]}):i.jsxs("div",{className:"admin-upload-area",children:[i.jsx("input",{type:"file",accept:"image/*,image/heic,image/heif,.heic,.heif",onChange:async e=>{const a=e.target.files[0];if(!a)return;if(a.type.startsWith("image/")||I(a)){E(!0);try{let n=a,t=a.name.split(".").pop();if(I(a))try{const e=(0,(await l(async()=>{const{default:e}=await import("./heic2any-DRSXiZIm.js").then(e=>e.h);return{default:e}},__vite__mapDeps([0,1]))).default)({blob:a,toType:"image/jpeg",quality:.8}),i=await H(e,2e4,"HEIC dönüşümü");n=Array.isArray(i)?i[0]:i,t="jpg"}catch(i){return f(i.message||"HEIC dönüştürülemedi. Lütfen bilgisayarda JPG/PNG'ye çevirip yükleyin.","error"),E(!1),void(e.target.value="")}const r=`${Date.now()}_${Math.random().toString(36).substring(7)}.${t}`,c=d(s,`images/gallery/${r}`),m=p(c,n).then(()=>y(c)),o=await H(m,3e4,"Yükleme");G(e=>({...e,image_url:o})),f("Resim yüklendi!","success")}catch(n){f(n.message||"Resim yüklenirken hata: "+(n.message||"Bilinmeyen hata"),"error")}finally{E(!1),e.target.value=""}}else f("Lütfen bir resim dosyası seçin (JPG, PNG, HEIC vb.)!","warning")},disabled:P,className:"admin-file-input"}),P&&i.jsxs("div",{className:"admin-upload-status",children:[i.jsx("i",{className:"fas fa-spinner fa-spin"})," Yükleniyor..."]}),i.jsx("p",{className:"admin-upload-hint",children:"JPG, PNG, WebP veya HEIC (iPhone) desteklenir. HEIC otomatik JPEG'e dönüştürülür."})]})]}),i.jsxs("div",{className:"admin-modal-actions",children:[i.jsx("button",{type:"button",onClick:()=>_(!1),className:"admin-btn-secondary",children:"İptal"}),i.jsx("button",{type:"submit",className:"admin-btn-primary",disabled:P,children:k?"Güncelle":"Kaydet"})]})]})]})})]})};export{f as default};
