import{d as a,j as s}from"./index-DggsiRlr.js";import{r as i}from"./react-vendor-CCsTzcwv.js";import{k as e,h as t,T as n,q as d,w as c,l,j as r}from"./firebase-vendor-BOy9xtg7.js";import{R as o,P as h,a as m,C as j,T as x,B as u,b as p,X as v,Y as f,c as N}from"./chart-vendor-D-W0nXT_.js";const g=["#DC2626","#EAB308","#EF4444","#FACC15","#B91C1C","#CA8A04","#991B1B","#A16207"],k=()=>{const[k,y]=i.useState({blogCount:0,projectCount:0,testimonialCount:0,messageCount:0,applicationCount:0}),[D,C]=i.useState({deviceData:[],durationData:[],dailyVisits:[],avgDuration:0,totalUniqueVisitors:0}),[w,S]=i.useState(!0);i.useEffect(()=>{V(),M()},[]);const V=async()=>{try{const[s,i,n,d,c]=await Promise.all([e(t(a,"blog_posts")),e(t(a,"projects")),e(t(a,"testimonials")),e(t(a,"contact_messages")),e(t(a,"job_applications"))]);y({blogCount:s.data().count||0,projectCount:i.data().count||0,testimonialCount:n.data().count||0,messageCount:d.data().count||0,applicationCount:c.data().count||0})}catch(s){}finally{S(!1)}},M=async()=>{try{const s=new Date;s.setDate(s.getDate()-30);const i=n.fromDate(s),e=d(t(a,"visit_logs"),c("created_at",">=",i),l("created_at","asc")),o=await r(e),h={},m={},j={};o.docs.forEach(a=>{var s;const i=a.data(),e=(null==(s=i.created_at)?void 0:s.toDate)?i.created_at.toDate():new Date(i.created_at),t=(a=>{if(!a)return"Unknown";const s=a.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(s)?/android/i.test(s)?/tablet/i.test(s)?"Android Tablet":"Android Mobile":/iphone/i.test(s)?"iPhone":/ipad/i.test(s)?"iPad":"Mobile":/windows/i.test(s)?"Windows PC":/macintosh|mac os x/i.test(s)?"Mac":/linux/i.test(s)?"Linux PC":"Desktop"})(i.user_agent);h[t]=(h[t]||0)+1;const n=i.ip_address;m[n]||(m[n]={firstVisit:e,lastVisit:e,pages:new Set});const d=m[n];e<d.firstVisit&&(d.firstVisit=e),e>d.lastVisit&&(d.lastVisit=e),d.pages.add(i.page);const c=e.toISOString().split("T")[0];j[c]=(j[c]||0)+1});const x=Object.entries(h).map(([a,s])=>({name:a,value:s})).sort((a,s)=>s.value-a.value),u=[];Object.values(m).forEach(a=>{const s=(a.lastVisit-a.firstVisit)/1e3;s>0&&u.push(s)});const p={"0-30 saniye":0,"30 saniye - 1 dakika":0,"1-3 dakika":0,"3-5 dakika":0,"5-10 dakika":0,"10-30 dakika":0,"30+ dakika":0};u.forEach(a=>{a<30?p["0-30 saniye"]++:a<60?p["30 saniye - 1 dakika"]++:a<180?p["1-3 dakika"]++:a<300?p["3-5 dakika"]++:a<600?p["5-10 dakika"]++:a<1800?p["10-30 dakika"]++:p["30+ dakika"]++});const v=Object.entries(p).map(([a,s])=>({name:a,value:s})).filter(a=>a.value>0),f=[];for(let a=6;a>=0;a--){const s=new Date;s.setDate(s.getDate()-a);const i=s.toISOString().split("T")[0];f.push({date:new Date(i).toLocaleDateString("tr-TR",{day:"numeric",month:"short"}),visits:j[i]||0})}const N=u.length>0?Math.round(u.reduce((a,s)=>a+s,0)/u.length):0;C({deviceData:x,durationData:v,dailyVisits:f,avgDuration:N,totalUniqueVisitors:Object.keys(m).length})}catch(s){}};return w?s.jsxs("div",{className:"admin-loading",children:[s.jsx("i",{className:"fas fa-spinner fa-spin"}),s.jsx("p",{children:"Yükleniyor..."})]}):s.jsxs("div",{className:"admin-dashboard",children:[s.jsxs("div",{className:"admin-dashboard-header",children:[s.jsx("h1",{children:"Dashboard"}),s.jsx("p",{children:"Hoş geldiniz! Sistem genel bakışı"})]}),s.jsxs("div",{className:"admin-stats-grid",children:[s.jsxs("div",{className:"admin-stat-card",children:[s.jsx("div",{className:"admin-stat-icon blog",children:s.jsx("i",{className:"fas fa-newspaper"})}),s.jsxs("div",{className:"admin-stat-content",children:[s.jsx("h3",{children:k.blogCount}),s.jsx("p",{children:"Blog Yazısı"})]})]}),s.jsxs("div",{className:"admin-stat-card",children:[s.jsx("div",{className:"admin-stat-icon project",children:s.jsx("i",{className:"fas fa-project-diagram"})}),s.jsxs("div",{className:"admin-stat-content",children:[s.jsx("h3",{children:k.projectCount}),s.jsx("p",{children:"Proje"})]})]}),s.jsxs("div",{className:"admin-stat-card",children:[s.jsx("div",{className:"admin-stat-icon testimonial",children:s.jsx("i",{className:"fas fa-comments"})}),s.jsxs("div",{className:"admin-stat-content",children:[s.jsx("h3",{children:k.testimonialCount}),s.jsx("p",{children:"Müşteri Yorumu"})]})]}),s.jsxs("div",{className:"admin-stat-card",children:[s.jsx("div",{className:"admin-stat-icon message",children:s.jsx("i",{className:"fas fa-envelope"})}),s.jsxs("div",{className:"admin-stat-content",children:[s.jsx("h3",{children:k.messageCount}),s.jsx("p",{children:"İletişim Mesajı"})]})]}),s.jsxs("div",{className:"admin-stat-card",children:[s.jsx("div",{className:"admin-stat-icon application",children:s.jsx("i",{className:"fas fa-briefcase"})}),s.jsxs("div",{className:"admin-stat-content",children:[s.jsx("h3",{children:k.applicationCount}),s.jsx("p",{children:"İş Başvurusu"})]})]})]}),s.jsxs("div",{className:"admin-visit-analytics",children:[s.jsxs("div",{className:"admin-charts-header",children:[s.jsx("h2",{children:"Ziyaretçi Analitiği"}),s.jsxs("div",{className:"admin-visit-summary",children:[s.jsxs("div",{className:"admin-visit-stat",children:[s.jsx("i",{className:"fas fa-users"}),s.jsxs("div",{children:[s.jsx("span",{className:"stat-value",children:D.totalUniqueVisitors}),s.jsx("span",{className:"stat-label",children:"Benzersiz Ziyaretçi"})]})]}),s.jsxs("div",{className:"admin-visit-stat",children:[s.jsx("i",{className:"fas fa-clock"}),s.jsxs("div",{children:[s.jsx("span",{className:"stat-value",children:b(D.avgDuration)}),s.jsx("span",{className:"stat-label",children:"Ortalama Kalış Süresi"})]})]})]})]}),s.jsxs("div",{className:"admin-charts-grid",children:[s.jsxs("div",{className:"admin-chart-card",children:[s.jsx("h3",{children:"Cihaz Dağılımı"}),s.jsx(o,{width:"100%",height:300,children:s.jsxs(h,{children:[s.jsx(m,{data:D.deviceData,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:s})=>`${a}: ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:D.deviceData.map((a,i)=>s.jsx(j,{fill:g[i%g.length]},`cell-${i}`))}),s.jsx(x,{})]})})]}),s.jsxs("div",{className:"admin-chart-card",children:[s.jsx("h3",{children:"Ziyaret Süreleri"}),s.jsx(o,{width:"100%",height:300,children:s.jsxs(u,{data:D.durationData,children:[s.jsx(p,{strokeDasharray:"3 3"}),s.jsx(v,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:{fontSize:12}}),s.jsx(f,{}),s.jsx(x,{}),s.jsx(N,{dataKey:"value",fill:"#667eea"})]})})]}),s.jsxs("div",{className:"admin-chart-card full-width",children:[s.jsx("h3",{children:"Son 7 Günlük Ziyaret Trendi"}),s.jsx(o,{width:"100%",height:300,children:s.jsxs(u,{data:D.dailyVisits,children:[s.jsx(p,{strokeDasharray:"3 3"}),s.jsx(v,{dataKey:"date"}),s.jsx(f,{}),s.jsx(x,{}),s.jsx(N,{dataKey:"visits",fill:"#764ba2"})]})})]})]})]}),s.jsxs("div",{className:"admin-quick-actions",children:[s.jsx("h2",{children:"Hızlı İşlemler"}),s.jsxs("div",{className:"admin-actions-grid",children:[s.jsxs("a",{href:"/admin/blog",className:"admin-action-card",children:[s.jsx("i",{className:"fas fa-circle-plus"}),s.jsx("span",{children:"Yeni Blog Yazısı"})]}),s.jsxs("a",{href:"/admin/projects",className:"admin-action-card",children:[s.jsx("i",{className:"fas fa-circle-plus"}),s.jsx("span",{children:"Yeni Proje Ekle"})]}),s.jsxs("a",{href:"/admin/testimonials",className:"admin-action-card",children:[s.jsx("i",{className:"fas fa-circle-plus"}),s.jsx("span",{children:"Yeni Yorum Ekle"})]})]})]})]})},b=a=>{if(!a||0===a)return"0 sn";if(a<60)return`${Math.round(a)} sn`;if(a<3600){return`${Math.floor(a/60)} dk ${Math.round(a%60)} sn`}return`${Math.floor(a/3600)} sa ${Math.floor(a%3600/60)} dk`};export{k as default};
