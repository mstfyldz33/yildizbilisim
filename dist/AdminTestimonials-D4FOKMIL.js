import{d as a,j as e,s}from"./index-DggsiRlr.js";import{r as i}from"./react-vendor-CCsTzcwv.js";import{q as n,h as t,l,j as r,v as m,p as d,e as c,x as o,f as u,r as x,y as h,u as j,n as p}from"./firebase-vendor-BOy9xtg7.js";const g=()=>{const[g,f]=i.useState([]),[y,v]=i.useState(!0),[N,b]=i.useState(!1),[k,_]=i.useState(null),[C,w]=i.useState({name:"",position:"",text:"",rating:5,image_url:""}),[Y,S]=i.useState(!1);i.useEffect(()=>{z()},[]);const z=async()=>{try{const e=n(t(a,"testimonials"),l("created_at","desc")),s=(await r(e)).docs.map(a=>({id:a.id,...a.data()}));f(s)}catch(e){f([])}finally{v(!1)}};return y?e.jsxs("div",{className:"admin-loading",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),e.jsx("p",{children:"Yükleniyor..."})]}):e.jsxs("div",{className:"admin-testimonials",children:[e.jsxs("div",{className:"admin-page-header",children:[e.jsx("h1",{children:"Müşteri Yorumları Yönetimi"}),e.jsxs("button",{onClick:()=>{_(null),w({name:"",position:"",text:"",rating:5,image_url:""}),b(!0)},className:"admin-btn-primary",children:[e.jsx("i",{className:"fas fa-plus"})," Yeni Yorum"]})]}),e.jsx("div",{className:"admin-table-container",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Görsel"}),e.jsx("th",{children:"Müşteri Adı"}),e.jsx("th",{children:"Pozisyon"}),e.jsx("th",{children:"Yorum"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"İşlemler"})]})}),e.jsx("tbody",{children:0===g.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"admin-empty",children:"Henüz yorum yok. İlk yorumu ekleyin!"})}):g.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,style:{width:"60px",height:"60px",objectFit:"cover",borderRadius:"8px"}}):e.jsx("i",{className:"fas fa-image",style:{color:"#94a3b8",fontSize:"1.5rem"}})}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.position}),e.jsxs("td",{className:"admin-text-preview",children:[s.text.substring(0,50),"..."]}),e.jsx("td",{children:e.jsx("div",{className:"admin-rating",children:[...Array(5)].map((a,i)=>e.jsx("i",{className:"fas fa-star "+(i<s.rating?"active":"")},i))})}),e.jsx("td",{children:e.jsxs("div",{className:"admin-actions",children:[e.jsxs("button",{onClick:()=>(a=>{_(a),w({name:a.name,position:a.position,text:a.text,rating:a.rating||5,image_url:a.image_url||""}),b(!0)})(s),className:"admin-btn-edit",children:[e.jsx("i",{className:"fas fa-pen-to-square"})," Düzenle"]}),e.jsxs("button",{onClick:()=>(async e=>{if(confirm("Bu yorumu silmek istediğinizden emin misiniz?"))try{await m(d(a,"testimonials",e)),z()}catch(s){alert("Hata: "+s.message)}})(s.id),className:"admin-btn-delete",children:[e.jsx("i",{className:"fas fa-trash"})," Sil"]})]})})]},s.id))})]})}),N&&e.jsx("div",{className:"admin-modal-overlay",onClick:()=>b(!1),children:e.jsxs("div",{className:"admin-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"admin-modal-header",children:[e.jsx("h2",{children:k?"Yorum Düzenle":"Yeni Yorum"}),e.jsx("button",{onClick:()=>b(!1),className:"admin-modal-close",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e={...C,created_at:k?void 0:c(),updated_at:c()};k?await o(d(a,"testimonials",k.id),e):await u(t(a,"testimonials"),e),b(!1),_(null),w({name:"",position:"",text:"",rating:5,image_url:""}),z()}catch(s){alert("Hata: "+s.message)}},className:"admin-modal-form",children:[e.jsxs("div",{className:"admin-form-group",children:[e.jsx("label",{children:"Müşteri Adı *"}),e.jsx("input",{type:"text",value:C.name,onChange:a=>w({...C,name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"admin-form-group",children:[e.jsx("label",{children:"Pozisyon *"}),e.jsx("input",{type:"text",value:C.position,onChange:a=>w({...C,position:a.target.value}),required:!0})]}),e.jsxs("div",{className:"admin-form-group",children:[e.jsx("label",{children:"Yorum Metni *"}),e.jsx("textarea",{value:C.text,onChange:a=>w({...C,text:a.target.value}),rows:"5",required:!0})]}),e.jsxs("div",{className:"admin-form-group",children:[e.jsx("label",{children:"Rating (1-5) *"}),e.jsx("input",{type:"number",min:"1",max:"5",value:C.rating,onChange:a=>w({...C,rating:parseInt(a.target.value)}),required:!0})]}),e.jsxs("div",{className:"admin-form-group",children:[e.jsx("label",{children:"Ekran Görüntüsü (Opsiyonel)"}),C.image_url?e.jsxs("div",{className:"admin-image-preview-form",children:[e.jsx("img",{src:C.image_url,alt:"Ekran görüntüsü"}),e.jsxs("button",{type:"button",onClick:async()=>{if(C.image_url){try{if(C.image_url.includes("firebasestorage")){const a=C.image_url.split("/"),e=a.slice(a.indexOf("o")+1).join("/"),i=decodeURIComponent(e.split("?")[0]),n=x(s,i);await h(n)}}catch(a){}w({...C,image_url:""})}},className:"admin-btn-delete admin-btn-small",children:[e.jsx("i",{className:"fas fa-times"})," Kaldır"]})]}):e.jsxs("div",{className:"admin-upload-area",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:async a=>{const e=a.target.files[0];if(e)if(e.type.startsWith("image/")){S(!0);try{const a=e.name.split(".").pop(),i=`${Date.now()}_${Math.random().toString(36).substring(7)}.${a}`,n=x(s,`images/testimonials/${i}`);await j(n,e);const t=await p(n);w({...C,image_url:t})}catch(i){alert("Resim yüklenirken hata oluştu: "+i.message)}finally{S(!1)}}else alert("Lütfen bir resim dosyası seçin!")},disabled:Y,className:"admin-file-input"}),Y&&e.jsxs("div",{className:"admin-upload-status",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Yükleniyor..."]}),e.jsx("p",{className:"admin-upload-hint",children:"Yorum ile ilgili ekran görüntüsü veya fotoğraf yükleyebilirsiniz."}),e.jsxs("div",{className:"admin-form-group",style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Veya Harici URL Girin"}),e.jsx("input",{type:"text",value:C.image_url,onChange:a=>w({...C,image_url:a.target.value}),placeholder:"https://... veya /images/...",style:{marginTop:"0.5rem"}})]})]})]}),e.jsxs("div",{className:"admin-modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"admin-btn-secondary",children:"İptal"}),e.jsx("button",{type:"submit",className:"admin-btn-primary",children:k?"Güncelle":"Kaydet"})]})]})]})})]})};export{g as default};
